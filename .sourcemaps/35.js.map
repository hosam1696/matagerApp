{"version":3,"sources":["../../src/pages/deliveryrequest/deliveryrequest.module.ts","../../src/pages/deliveryrequest/deliveryrequest.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAyC;AACO;AACQ;AACiC;AAazF;IAAA;IAAwC,CAAC;IAA5B,yBAAyB;QAZrC,+DAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,6EAAmB;aACpB;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,6EAAmB,CAAC;gBAC7C,0GAAwB;aACzB;YACD,OAAO,EAAE;gBACP,6EAAmB;aACpB;SACF,CAAC;OACW,yBAAyB,CAAG;IAAD,gCAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;AChBY;AACmC;AACjC;AAEI;AACI;AAM5D;IAaE,6BACiC,WAAW,EACnC,OAAsB,EACtB,SAAoB,EACnB,YAA0B,EAC1B,cAA8B,EAC9B,gBAAkC,EACnC,SAA0B;QANF,gBAAW,GAAX,WAAW;QACnC,YAAO,GAAP,OAAO,CAAe;QACtB,cAAS,GAAT,SAAS,CAAW;QACnB,iBAAY,GAAZ,YAAY,CAAc;QAC1B,mBAAc,GAAd,cAAc,CAAgB;QAC9B,qBAAgB,GAAhB,gBAAgB,CAAkB;QACnC,cAAS,GAAT,SAAS,CAAiB;QAjBnC,eAAU,GAAG,CAAC,CAAC;QACf,cAAS,GAAe,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC;QAK1E,eAAU,GAAY,IAAI,CAAC;QAC3B,uBAAkB,GAAY,KAAK,CAAC;QACpC,eAAU,GAAY,KAAK,CAAC;QAC5B,WAAM,GAAY,KAAK,CAAC;IAUxB,CAAC;IAED,8CAAgB,GAAhB;QACE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC;IACrE,CAAC;IACD,4CAAc,GAAd;QACE,OAAO,CAAC,GAAG,CAAC,oCAAoC,CAAC,CAAC;QAClD,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YACpB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC;QAErE,CAAC;QACD,yEAAyE;QACzE,IAAI,CAAC,yBAAyB,EAAE,CAAC;QACjC,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACjC,CAAC;IAED,yCAAW,GAAX;QAAA,iBA6BC;QA5BC,IAAI,CAAC,YAAY;aACd,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC;aACrC,KAAK,CAAC,CAAC,CAAC;aACR,SAAS,CACV,UAAC,EAAwB;gBAAtB,kBAAM,EAAE,cAAI,EAAE,kBAAM;YACrB,EAAE,CAAC,CAAC,MAAM,IAAI,SAAS,IAAI,MAAM,CAAC,OAAO,IAAI,SAAS,CAAC,CAAC,CAAC;gBACvD,IAAI,CAAC,OAAO,CAAC,iBAAO;oBAClB,OAAO,CAAC,aAAa,GAAG,CAAC,CAAC;oBAC1B,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC;gBAC5B,CAAC,CAAC,CAAC;gBACH,KAAI,CAAC,WAAW,GAAG,IAAI,CAAC,CAAC,qCAAqC;gBAC9D,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAClB,KAAI,CAAC,WAAW,GAAG,KAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,gCAAgC;gBACxE,OAAO,CAAC,GAAG,CAAC,KAAI,CAAC,WAAW,CAAC,CAAC;YAChC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,KAAI,CAAC,UAAU,GAAG,IAAI,CAAC;gBACvB,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACvB,CAAC;QACH,CAAC,EACD,aAAG;YACD,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClB,KAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,KAAI,CAAC,MAAM,GAAG,IAAI;QACpB,CAAC,EACD;YACE,KAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAC1B,CAAC,CACA;IACL,CAAC;IAED,4CAAc,GAAd,UAAe,OAAO;QAEpB,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAErB,OAAO,CAAC,SAAS,GAAG,CAAC,OAAO,CAAC,SAAS,CAAC;QAEvC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IACvB,CAAC;IAED,uDAAyB,GAAzB;QAAA,iBA2BC;QA1BC,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC;aACvD,SAAS,CACV,UAAC,EAAwB;gBAAtB,kBAAM,EAAE,cAAI,EAAE,kBAAM;YACrB,EAAE,CAAC,CAAC,MAAM,IAAI,SAAS,CAAC,CAAC,CAAC;gBACxB,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC;oBACrB,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;oBACpC,KAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;gBACjC,CAAC;gBAED,KAAI,CAAC,MAAM,GAAG,IAAI,CAAC;gBACnB,KAAI,CAAC,SAAS,GAAG,KAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;YAE5C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,KAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;gBAC/B,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC;YACtB,CAAC;QACH,CAAC,EACD,aAAG;YACD,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClB,KAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAE1B,CAAC,EACD;YACE,KAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAC1B,CAAC,CACA;IACL,CAAC;IAEO,mCAAK,GAAb,UAAc,GAAG,EAAE,KAAK;QACtB,IAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;QACxB,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,OAAO,KAAK,GAAG,MAAM,EAAE,CAAC;YACtB,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC;YAC9C,KAAK,IAAI,KAAK;QAChB,CAAC;QACD,MAAM,CAAC,OAAO,CAAC;IACjB,CAAC;IAGD,4CAAc,GAAd,UAAe,IAAI,EAAE,QAAe;QAAf,0CAAe;QAClC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,QAAQ,YAAE,CAAC,CAAC;IACxC,CAAC;IAED,8CAAgB,GAAhB,UAAiB,OAAO;QACtB,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,IAAI,cAAc,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,GAAG,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC;QAChF,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC5B,OAAO,CAAC,aAAa,GAAG,cAAc,CAAC;QACvC,uEAAuE;IACzE,CAAC;IAED,8CAAgB,GAAhB,UAAiB,OAAO;QACtB,IAAI,cAAc,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,GAAG,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC;QAChF,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC5B,OAAO,CAAC,aAAa,GAAG,cAAc,CAAC;IACzC,CAAC;IAED,gDAAkB,GAAlB;QAAA,iBA+CC;QA7CC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YAElB,qCAAgE,EAA/D,iBAAS,EAAE,gBAAQ,EAAE,kBAAU,CAAiC;YAErE,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC;YAE7C,IAAI,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,iBAAO,IAAI,cAAO,CAAC,SAAS,IAAI,IAAI,EAAzB,CAAyB,CAAC,CAAC,GAAG,CAAC,UAAC,OAAO,IAAO,MAAM,CAAC,EAAE,SAAS,EAAE,OAAO,CAAC,EAAE,EAAE,aAAa,EAAE,OAAO,CAAC,aAAa,EAAE,EAAC,CAAC,CAAC,CAAC;YAEvK,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBACrB,IAAI,WAAW,GAAG;oBAChB,KAAK;oBACL,QAAQ;oBACR,UAAU;oBACV,SAAS;oBACT,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE;iBAC3B,CAAC;gBACF,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC;gBAElC,IAAI,CAAC,gBAAgB;qBAClB,kBAAkB,CAAC,WAAW,CAAC;qBAC/B,KAAK,CAAC,CAAC,CAAC;qBACR,YAAY,CAAC,IAAI,CAAC;qBAClB,SAAS,CAAC,UAAC,EAAkB;wBAAhB,kBAAM,EAAE,kBAAM;oBAC1B,EAAE,CAAC,CAAC,MAAM,IAAI,SAAS,CAAC,CAAC,CAAC;wBACxB,KAAI,CAAC,SAAS,CAAC,4BAA4B,CAAC,CAAC;wBAC7C,UAAU,CAAC;4BACT,KAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;wBACrB,CAAC,EAAE,IAAI,CAAC,CAAC;oBACX,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACN,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;wBACrB,KAAI,CAAC,SAAS,CAAC,YAAY,CAAC;oBAC9B,CAAC;gBACH,CAAC,EACD,aAAG;oBACD,KAAI,CAAC,SAAS,CAAC,+BAA+B,CAAC;gBACjD,CAAC,CAAC;YACN,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,IAAI,CAAC,SAAS,CAAC,gCAAgC,CAAC;YAClD,CAAC;QAEH,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,SAAS,CAAC,qBAAqB,CAAC,CAAC;QACxC,CAAC;IAGH,CAAC;IAED,yCAAW,GAAX,UAAY,GAAW;QACrB,MAAM,CAAC,CAAC,GAAG,CAAC,MAAM,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,OAAO,GAAG,GAAG,CAAC;IAC9D,CAAC;IAED,yCAAW,GAAX,UAAY,KAAK,EAAE,OAAO;QACxB,IAAI,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;QACrC,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC;QAChC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACnC,OAAO,CAAC,aAAa,GAAG,WAAW,CAAC;QACpC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;IAErC,CAAC;IAED,uCAAS,GAAT,UAAU,GAAG;QACX,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAChC,OAAO,EAAE,GAAG;YACZ,QAAQ,EAAE,IAAI;YACd,QAAQ,EAAE,KAAK;SAChB,CAAC,CAAC;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;IAClB,CAAC;IAED,uCAAS,GAAT,UAAU,IAAW,EAAE,GAAW;QAChC,MAAM,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG;IAC5C,CAAC;IArNU,mBAAmB;QAL/B,wEAAS,EAAE;QACX,gEAAS,CAAC;YACT,QAAQ,EAAE,sBAAsB;WACG;SACpC,CAAC;QAeG,iBAAM,CAAC,aAAa,CAAC;6EACO;YACX,qEAAS;YACL,yEAAY;YACV,6EAAc;YACZ,uEAAgB;YACxB,eAAe;OApBxB,mBAAmB,CAuN/B;IAAD,CAAC;AAAA;SAvNY,mBAAmB,e","file":"35.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { DeliveryrequestPage } from './deliveryrequest';\r\nimport { HsaloaderComponentModule } from '../../components/hsa-loader/hsa-loader.module';\r\n@NgModule({\r\n  declarations: [\r\n    DeliveryrequestPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(DeliveryrequestPage),\r\n    HsaloaderComponentModule\r\n  ],\r\n  exports: [\r\n    DeliveryrequestPage\r\n  ]\r\n})\r\nexport class DeliveryrequestPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/deliveryrequest/deliveryrequest.module.ts","import { Component, Inject } from '@angular/core';\r\nimport { NavController, NavParams, IonicPage, ToastController } from 'ionic-angular';\r\nimport { ItemProvider } from '../../providers/item';\r\nimport { IlocalUser, IShelfRequest } from '../../app/service/interfaces';\r\nimport { ShelfsProvider } from '../../providers/shelfs';\r\nimport { DeliveryProvider } from '../../providers/delivery';\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-deliveryrequest',\r\n  templateUrl: 'deliveryrequest.html',\r\n})\r\nexport class DeliveryrequestPage {\r\n\r\n  shelfNumbers;\r\n  timeStarts = 1;\r\n  userLocal: IlocalUser = JSON.parse(localStorage.getItem('userLocalData'));\r\n  Shelfs: IShelfRequest[];\r\n  matgar_id: number;\r\n  AllProducts: any;\r\n  allProducts: any;\r\n  showLoader: boolean = true;\r\n  noAcceptedRequests: boolean = false;\r\n  noProducts: boolean = false;\r\n  netErr: boolean = false;\r\n  constructor(\r\n    @Inject('UPLOAD_PATH') private UPLOAD_PATH,\r\n    public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    private itemProvider: ItemProvider,\r\n    private shelfsProvider: ShelfsProvider,\r\n    private deliveryProvider: DeliveryProvider,\r\n    public toastCtrl: ToastController\r\n  ) {\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    this.userLocal = JSON.parse(localStorage.getItem('userLocalData'));\r\n  }\r\n  ionViewDidLoad() {\r\n    console.log('ionViewDidLoad DeliverproductsPage');\r\n    this.timeStarts = 1;\r\n    if (!this.userLocal) {\r\n      this.userLocal = JSON.parse(localStorage.getItem('userLocalData'));\r\n\r\n    }\r\n    //TODO: if i have time i will use observable.merge in both functions blew\r\n    this.getAcceptedShelfsRequests();\r\n    this.getProducts();\r\n\r\n    console.log(this.shelfNumbers);\r\n  }\r\n\r\n  getProducts() {\r\n    this.itemProvider\r\n      .getProductByUserId(this.userLocal.id)\r\n      .retry(3)\r\n      .subscribe(\r\n      ({ status, data, errors }) => {\r\n        if (status == 'success' || status.message == 'success') {\r\n          data.forEach(product => {\r\n            product.item_quantity = 1;\r\n            product.isChecked = false;\r\n          });\r\n          this.allProducts = data; // to be used in delivery request API\r\n          console.log(data);\r\n          this.AllProducts = this.chunk(data, 2); // to be used in HTML projection\r\n          console.log(this.AllProducts);\r\n        } else {\r\n          this.noProducts = true;\r\n          console.warn(errors);\r\n        }\r\n      },\r\n      err => {\r\n        console.warn(err);\r\n        this.showLoader = false;\r\n        this.netErr = true\r\n      },\r\n      () => {\r\n        this.showLoader = false;\r\n      }\r\n      )\r\n  }\r\n\r\n  triggerChecked(product): void {\r\n\r\n    console.log(product);\r\n\r\n    product.isChecked = !product.isChecked;\r\n\r\n    console.log(product);\r\n  }\r\n\r\n  getAcceptedShelfsRequests() {\r\n    this.shelfsProvider.getAcceptedRequests(this.userLocal.id)\r\n      .subscribe(\r\n      ({ status, data, errors }) => {\r\n        if (status == 'success') {\r\n          if (data.length <= 0) {\r\n            console.log('no accepted requests');\r\n            this.noAcceptedRequests = true;\r\n          }\r\n\r\n          this.Shelfs = data;\r\n          this.matgar_id = this.Shelfs[0].matger_id;\r\n\r\n        } else {\r\n          this.noAcceptedRequests = true;\r\n          console.warn(errors)\r\n        }\r\n      },\r\n      err => {\r\n        console.warn(err);\r\n        this.showLoader = false;\r\n\r\n      },\r\n      () => {\r\n        this.showLoader = false;\r\n      }\r\n      )\r\n  }\r\n\r\n  private chunk(arr, limit) {\r\n    let length = arr.length;\r\n    let chunked = [];\r\n    let start = 0;\r\n    while (start < length) {\r\n      chunked.push(arr.slice(start, limit + start));\r\n      start += limit\r\n    }\r\n    return chunked;\r\n  }\r\n\r\n\r\n  navigateToPage(page, pageData = null) {\r\n    this.navCtrl.push(page, { pageData });\r\n  }\r\n\r\n  increaseQuantity(product) {\r\n    console.log(product);\r\n    let editedQuantity = Math.max(1, Math.min(product.item_quantity + 1, Infinity));\r\n    console.log(editedQuantity);\r\n    product.item_quantity = editedQuantity;\r\n    //this.render.setAttribute(this.ele.nativeElement.id == 1, 'value', '')\r\n  }\r\n\r\n  decreaseQuantity(product) {\r\n    let editedQuantity = Math.max(1, Math.min(product.item_quantity - 1, Infinity));\r\n    console.log(editedQuantity);\r\n    product.item_quantity = editedQuantity;\r\n  }\r\n\r\n  addDeliveryRequest() {\r\n\r\n    if (this.shelfNumbers) {\r\n\r\n      let [matger_id, shelf_id, shelf_name] = this.shelfNumbers.split(',');\r\n\r\n      console.log(matger_id, shelf_id, shelf_name);\r\n\r\n      let items = this.allProducts.filter(product => product.isChecked == true).map((product) => { return { 'item_id': product.id, item_quantity: product.item_quantity } });\r\n\r\n      if (items.length > 0) {\r\n        let requestData = {\r\n          items,\r\n          shelf_id,\r\n          shelf_name,\r\n          matger_id,\r\n          user_id: this.userLocal.id\r\n        };\r\n        console.table(items, requestData);\r\n\r\n        this.deliveryProvider\r\n          .addDeliveryRequest(requestData)\r\n          .retry(2)\r\n          .debounceTime(1500)\r\n          .subscribe(({ status, errors }) => {\r\n            if (status == 'success') {\r\n              this.showToast('تم ارسال طلب التسليم بنجاح');\r\n              setTimeout(() => {\r\n                this.navCtrl.pop();\r\n              }, 2000);\r\n            } else {\r\n              console.warn(errors);\r\n              this.showToast('حاول مجددا')\r\n            }\r\n          },\r\n          err => {\r\n            this.showToast('التطبيق يتطلب اتصال بالانترنت')\r\n          })\r\n      } else {\r\n        this.showToast('يرجى تحديد منتجات لطلب تسليمها')\r\n      }\r\n\r\n    } else {\r\n      this.showToast('يرجى ادخال رقم الرف');\r\n    }\r\n\r\n\r\n  }\r\n\r\n  limitString(str: string): string {\r\n    return (str.length > 55) ? str.slice(0, 50) + '.....' : str;\r\n  }\r\n\r\n  changeValue(event, product): void {\r\n    let targetValue = event.target.value;\r\n    console.log(event, targetValue);\r\n    console.log(product.item_quantity);\r\n    product.item_quantity = targetValue;\r\n    console.log(product.item_quantity);\r\n\r\n  }\r\n\r\n  showToast(msg) {\r\n    let toast = this.toastCtrl.create({\r\n      message: msg,\r\n      duration: 3000,\r\n      position: 'top'\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  imagePath(type:string, img: string):string {\r\n    return this.UPLOAD_PATH + type + '/' + img\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/deliveryrequest/deliveryrequest.ts"],"sourceRoot":""}